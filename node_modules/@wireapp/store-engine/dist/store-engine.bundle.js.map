{"version":3,"sources":["webpack://StoreEngine/webpack/bootstrap","webpack://StoreEngine/./dist/commonjs/engine/error/index.js","webpack://StoreEngine/./dist/commonjs/store/TransientBundle.js","webpack://StoreEngine/./dist/commonjs/index.js","webpack://StoreEngine/./dist/commonjs/engine/index.js","webpack://StoreEngine/./dist/commonjs/engine/CRUDEngine.js","webpack://StoreEngine/./dist/commonjs/engine/MemoryEngine.js","webpack://StoreEngine/./dist/commonjs/engine/error/LowDiskSpaceError.js","webpack://StoreEngine/./dist/commonjs/engine/error/PathValidationError.js","webpack://StoreEngine/./dist/commonjs/engine/error/RecordAlreadyExistsError.js","webpack://StoreEngine/./dist/commonjs/engine/error/RecordNotFoundError.js","webpack://StoreEngine/./dist/commonjs/engine/error/RecordTypeError.js","webpack://StoreEngine/./dist/commonjs/engine/error/UnsupportedError.js","webpack://StoreEngine/./dist/commonjs/store/index.js","webpack://StoreEngine/./dist/commonjs/store/ExpiredBundle.js","webpack://StoreEngine/./dist/commonjs/store/TransientStore.js","webpack://StoreEngine//home/travis/build/wireapp/wire-web-packages/node_modules/events/events.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","LowDiskSpaceError_1","LowDiskSpaceError","PathValidationError_1","PathValidationError","RecordAlreadyExistsError_1","RecordAlreadyExistsError","RecordNotFoundError_1","RecordNotFoundError","RecordTypeError_1","RecordTypeError","UnsupportedError_1","UnsupportedError","TransientBundle","this","expires","Store","error","engine_1","MemoryEngine","__createBinding","k","k2","undefined","__exportStar","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","error_1","storeName","stores","autoIncrementedPrimaryKey","tableName","primaryKey","entity","prepareTable","message","tableNames","keys","all","map","deleteAll","assignDb","promises","push","read","changes","updatedEntity","assign","update","Error","super","setPrototypeOf","code","ExpiredBundle","cacheKey","TransientStore","events_1","TransientBundle_1","TOPIC","EventEmitter","engine","bundles","constructCacheKey","deleteFromStore","deleteFromCache","_a","timeoutID","clearTimeout","cachedBundle","getFromCache","getFromStore","cacheKeys","readBundles","readAllPrimaryKeys","index","bundle","startTimer","record","ttl","createTransientBundle","save","transientBundle","saveInCache","replace","Date","now","payload","delete","expiredBundle","constructPrimaryKey","cacheBundle","saveInStore","timespan","expireBundle","setTimeout","emit","EXPIRED","ReflectOwnKeys","R","Reflect","ReflectApply","target","receiver","args","Function","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","init","_events","_eventsCount","_maxListeners","defaultMaxListeners","$getMaxListeners","that","_addListener","type","listener","prepend","events","existing","warning","TypeError","newListener","unshift","length","warned","w","String","emitter","count","console","warn","onceWrapper","arguments","fired","removeListener","wrapFn","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","Array","unwrapListeners","arrayClone","listenerCount","copy","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","er","err","context","handler","len","listeners","addListener","on","prependListener","once","prependOnceListener","list","position","originalListener","shift","pop","spliceOne","off","removeAllListeners","rawListeners","eventNames"],"mappings":"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","file":"store-engine.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar LowDiskSpaceError_1 = require(\"./LowDiskSpaceError\");\nObject.defineProperty(exports, \"LowDiskSpaceError\", { enumerable: true, get: function () { return LowDiskSpaceError_1.LowDiskSpaceError; } });\nvar PathValidationError_1 = require(\"./PathValidationError\");\nObject.defineProperty(exports, \"PathValidationError\", { enumerable: true, get: function () { return PathValidationError_1.PathValidationError; } });\nvar RecordAlreadyExistsError_1 = require(\"./RecordAlreadyExistsError\");\nObject.defineProperty(exports, \"RecordAlreadyExistsError\", { enumerable: true, get: function () { return RecordAlreadyExistsError_1.RecordAlreadyExistsError; } });\nvar RecordNotFoundError_1 = require(\"./RecordNotFoundError\");\nObject.defineProperty(exports, \"RecordNotFoundError\", { enumerable: true, get: function () { return RecordNotFoundError_1.RecordNotFoundError; } });\nvar RecordTypeError_1 = require(\"./RecordTypeError\");\nObject.defineProperty(exports, \"RecordTypeError\", { enumerable: true, get: function () { return RecordTypeError_1.RecordTypeError; } });\nvar UnsupportedError_1 = require(\"./UnsupportedError\");\nObject.defineProperty(exports, \"UnsupportedError\", { enumerable: true, get: function () { return UnsupportedError_1.UnsupportedError; } });\n//# sourceMappingURL=index.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TransientBundle = void 0;\nclass TransientBundle {\n    constructor() {\n        this.expires = 0;\n    }\n}\nexports.TransientBundle = TransientBundle;\n//# sourceMappingURL=TransientBundle.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Store = exports.error = void 0;\nvar engine_1 = require(\"./engine/\");\nObject.defineProperty(exports, \"MemoryEngine\", { enumerable: true, get: function () { return engine_1.MemoryEngine; } });\nconst error = require(\"./engine/error/\");\nexports.error = error;\nconst Store = require(\"./store/\");\nexports.Store = Store;\n//# sourceMappingURL=index.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) __createBinding(exports, m, p);\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./CRUDEngine\"), exports);\n__exportStar(require(\"./MemoryEngine\"), exports);\n//# sourceMappingURL=index.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=CRUDEngine.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MemoryEngine = void 0;\nconst error_1 = require(\"./error/\");\nclass MemoryEngine {\n    constructor() {\n        this.storeName = '';\n        this.stores = {};\n        this.autoIncrementedPrimaryKey = 1;\n    }\n    create(tableName, primaryKey, entity) {\n        if (entity) {\n            this.prepareTable(tableName);\n            if (primaryKey === undefined) {\n                primaryKey = this.autoIncrementedPrimaryKey;\n                this.autoIncrementedPrimaryKey += 1;\n            }\n            const record = this.stores[this.storeName][tableName][primaryKey];\n            if (record) {\n                const message = `Record \"${primaryKey}\" already exists in \"${tableName}\". You need to delete the record first if you want to overwrite it.`;\n                const error = new error_1.RecordAlreadyExistsError(message);\n                return Promise.reject(error);\n            }\n            this.stores[this.storeName][tableName][primaryKey] = entity;\n            return Promise.resolve(primaryKey);\n        }\n        const message = `Record \"${primaryKey}\" cannot be saved in \"${tableName}\" because it's \"undefined\" or \"null\".`;\n        return Promise.reject(new error_1.RecordTypeError(message));\n    }\n    clearTables() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const tableNames = Object.keys(this.stores);\n            yield Promise.all(tableNames.map(tableName => this.deleteAll(tableName)));\n        });\n    }\n    delete(tableName, primaryKey) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.prepareTable(tableName);\n            delete this.stores[this.storeName][tableName][primaryKey];\n            return primaryKey;\n        });\n    }\n    deleteAll(tableName) {\n        return __awaiter(this, void 0, void 0, function* () {\n            delete this.stores[this.storeName][tableName];\n            return true;\n        });\n    }\n    init(storeName) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.assignDb(storeName, {});\n        });\n    }\n    initWithObject(storeName, object) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.assignDb(storeName, object);\n        });\n    }\n    assignDb(storeName, object) {\n        this.storeName = storeName;\n        this.stores[this.storeName] = this.stores[this.storeName] || object;\n        return this.stores;\n    }\n    isSupported() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // Always available\n        });\n    }\n    purge() {\n        return __awaiter(this, void 0, void 0, function* () {\n            delete this.stores[this.storeName];\n        });\n    }\n    read(tableName, primaryKey) {\n        this.prepareTable(tableName);\n        if (this.stores[this.storeName][tableName].hasOwnProperty(primaryKey)) {\n            return Promise.resolve(this.stores[this.storeName][tableName][primaryKey]);\n        }\n        const message = `Record \"${primaryKey}\" in \"${tableName}\" could not be found.`;\n        return Promise.reject(new error_1.RecordNotFoundError(message));\n    }\n    readAll(tableName) {\n        this.prepareTable(tableName);\n        const promises = [];\n        for (const primaryKey of Object.keys(this.stores[this.storeName][tableName])) {\n            promises.push(this.read(tableName, primaryKey));\n        }\n        return Promise.all(promises);\n    }\n    readAllPrimaryKeys(tableName) {\n        this.prepareTable(tableName);\n        return Promise.resolve(Object.keys(this.stores[this.storeName][tableName]));\n    }\n    update(tableName, primaryKey, changes) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.prepareTable(tableName);\n            const entity = yield this.read(tableName, primaryKey);\n            const updatedEntity = Object.assign(Object.assign({}, entity), changes);\n            this.stores[this.storeName][tableName][primaryKey] = updatedEntity;\n            return primaryKey;\n        });\n    }\n    updateOrCreate(tableName, primaryKey, changes) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.prepareTable(tableName);\n            try {\n                yield this.update(tableName, primaryKey, changes);\n                return primaryKey;\n            }\n            catch (error) {\n                if (error instanceof error_1.RecordNotFoundError) {\n                    const newPrimaryKey = yield this.create(tableName, primaryKey, changes);\n                    return newPrimaryKey;\n                }\n                throw error;\n            }\n        });\n    }\n    prepareTable(tableName) {\n        if (!this.stores[this.storeName][tableName]) {\n            this.stores[this.storeName][tableName] = {};\n        }\n    }\n}\nexports.MemoryEngine = MemoryEngine;\n//# sourceMappingURL=MemoryEngine.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.LowDiskSpaceError = void 0;\nclass LowDiskSpaceError extends Error {\n    constructor(message = 'Not enough storage to save the record.') {\n        super(message);\n        this.message = message;\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nexports.LowDiskSpaceError = LowDiskSpaceError;\n//# sourceMappingURL=LowDiskSpaceError.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PathValidationError = void 0;\nclass PathValidationError extends Error {\n    constructor(message) {\n        super(message);\n        this.message = message;\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nexports.PathValidationError = PathValidationError;\n//# sourceMappingURL=PathValidationError.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RecordAlreadyExistsError = void 0;\nclass RecordAlreadyExistsError extends Error {\n    constructor(message) {\n        super(message);\n        this.message = message;\n        this.code = 1;\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nexports.RecordAlreadyExistsError = RecordAlreadyExistsError;\n//# sourceMappingURL=RecordAlreadyExistsError.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RecordNotFoundError = void 0;\nclass RecordNotFoundError extends Error {\n    constructor(message) {\n        super(message);\n        this.message = message;\n        this.code = 2;\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nexports.RecordNotFoundError = RecordNotFoundError;\n//# sourceMappingURL=RecordNotFoundError.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RecordTypeError = void 0;\nclass RecordTypeError extends Error {\n    constructor(message) {\n        super(message);\n        this.message = message;\n        this.code = 3;\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nexports.RecordTypeError = RecordTypeError;\n//# sourceMappingURL=RecordTypeError.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.UnsupportedError = void 0;\nclass UnsupportedError extends Error {\n    constructor(message) {\n        super(message);\n        this.message = message;\n        this.code = 4;\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nexports.UnsupportedError = UnsupportedError;\n//# sourceMappingURL=UnsupportedError.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) __createBinding(exports, m, p);\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./ExpiredBundle\"), exports);\n__exportStar(require(\"./TransientBundle\"), exports);\n__exportStar(require(\"./TransientStore\"), exports);\n//# sourceMappingURL=index.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ExpiredBundle = void 0;\nclass ExpiredBundle {\n    constructor() {\n        this.cacheKey = '';\n        this.primaryKey = '';\n    }\n}\nexports.ExpiredBundle = ExpiredBundle;\n//# sourceMappingURL=ExpiredBundle.js.map","\"use strict\";\n/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TransientStore = void 0;\nconst events_1 = require(\"events\");\nconst error_1 = require(\"../engine/error/\");\nconst TransientBundle_1 = require(\"./TransientBundle\");\nvar TOPIC;\n(function (TOPIC) {\n    TOPIC[\"EXPIRED\"] = \"expired\";\n})(TOPIC || (TOPIC = {}));\nlet TransientStore = /** @class */ (() => {\n    class TransientStore extends events_1.EventEmitter {\n        constructor(engine) {\n            super();\n            this.engine = engine;\n            this.bundles = {};\n            this.tableName = '';\n        }\n        delete(primaryKey) {\n            return __awaiter(this, void 0, void 0, function* () {\n                const cacheKey = this.constructCacheKey(primaryKey);\n                yield Promise.all([this.deleteFromStore(primaryKey), this.deleteFromCache(cacheKey)]);\n                return cacheKey;\n            });\n        }\n        deleteFromCache(cacheKey) {\n            var _a;\n            const timeoutID = (_a = this.bundles[cacheKey]) === null || _a === void 0 ? void 0 : _a.timeoutID;\n            if (timeoutID) {\n                clearTimeout(timeoutID);\n            }\n            delete this.bundles[cacheKey];\n            return cacheKey;\n        }\n        get(primaryKey) {\n            return __awaiter(this, void 0, void 0, function* () {\n                try {\n                    const cachedBundle = yield this.getFromCache(primaryKey);\n                    return cachedBundle !== undefined ? cachedBundle : yield this.getFromStore(primaryKey);\n                }\n                catch (error) {\n                    if (error instanceof error_1.RecordNotFoundError) {\n                        return undefined;\n                    }\n                    throw error;\n                }\n            });\n        }\n        init(tableName) {\n            return __awaiter(this, void 0, void 0, function* () {\n                this.tableName = tableName;\n                const cacheKeys = [];\n                const primaryKeys = yield this.engine.readAllPrimaryKeys(this.tableName);\n                const readBundles = primaryKeys.map(primaryKey => {\n                    const cacheKey = this.constructCacheKey(primaryKey);\n                    cacheKeys.push(cacheKey);\n                    return this.engine.read(this.tableName, primaryKey);\n                });\n                const bundles = yield Promise.all(readBundles);\n                for (const index in bundles) {\n                    const bundle = bundles[index];\n                    const cacheKey = cacheKeys[index];\n                    yield this.startTimer(cacheKey);\n                    this.bundles[cacheKey] = bundle;\n                }\n                return bundles;\n            });\n        }\n        /**\n         * Saves a transient record to the store and starts a timer to remove this record when the time to live (TTL) ended.\n         * @param primaryKey Primary key from which the FQN is created\n         * @param record A payload which should be kept in the TransientStore\n         * @param ttl The time to live (TTL) in milliseconds (ex. 1000 is 1s)\n         * @returns A transient bundle, wrapping the initial record\n         */\n        set(primaryKey, record, ttl) {\n            return __awaiter(this, void 0, void 0, function* () {\n                const bundle = this.createTransientBundle(record, ttl);\n                const cachedBundle = yield this.getFromCache(primaryKey);\n                if (cachedBundle) {\n                    const message = `Record with primary key \"${primaryKey}\" already exists in table \"${this.tableName}\" of database \"${this.engine.storeName}\".`;\n                    throw new error_1.RecordAlreadyExistsError(message);\n                }\n                else {\n                    const cacheKey = yield this.save(primaryKey, bundle);\n                    const transientBundle = yield this.startTimer(cacheKey);\n                    // Note: Save bundle with timeoutID in cache (not in persistent storage)\n                    return this.saveInCache(cacheKey, transientBundle);\n                }\n            });\n        }\n        /**\n         * Returns a fully qualified name (FQN) which can be used to cache a transient bundle.\n         * @param primaryKey Primary key from which the FQN is created\n         * @returns A fully qualified name\n         */\n        constructCacheKey(primaryKey) {\n            return `${this.engine.storeName}@${this.tableName}@${primaryKey}`;\n        }\n        constructPrimaryKey(cacheKey) {\n            return cacheKey.replace(`${this.engine.storeName}@${this.tableName}@`, '');\n        }\n        createTransientBundle(record, ttl) {\n            return {\n                expires: Date.now() + ttl,\n                payload: record,\n            };\n        }\n        deleteFromStore(primaryKey) {\n            return this.engine.delete(this.tableName, primaryKey);\n        }\n        expireBundle(cacheKey) {\n            return __awaiter(this, void 0, void 0, function* () {\n                const expiredBundle = {\n                    cacheKey: cacheKey,\n                    payload: this.bundles[cacheKey].payload,\n                    primaryKey: this.constructPrimaryKey(cacheKey),\n                };\n                yield this.delete(expiredBundle.primaryKey);\n                return expiredBundle;\n            });\n        }\n        getFromCache(primaryKey) {\n            const cacheBundle = this.bundles[this.constructCacheKey(primaryKey)];\n            return Promise.resolve(cacheBundle);\n        }\n        getFromStore(primaryKey) {\n            return this.engine.read(this.tableName, primaryKey);\n        }\n        save(primaryKey, bundle) {\n            return __awaiter(this, void 0, void 0, function* () {\n                const cacheKey = this.constructCacheKey(primaryKey);\n                yield Promise.all([this.saveInStore(primaryKey, bundle), this.saveInCache(cacheKey, bundle)]);\n                return cacheKey;\n            });\n        }\n        saveInCache(cacheKey, bundle) {\n            return (this.bundles[cacheKey] = bundle);\n        }\n        saveInStore(primaryKey, bundle) {\n            return this.engine.create(this.tableName, primaryKey, bundle);\n        }\n        startTimer(cacheKey) {\n            return __awaiter(this, void 0, void 0, function* () {\n                const primaryKey = this.constructPrimaryKey(cacheKey);\n                let bundle = yield this.get(primaryKey);\n                if (!bundle) {\n                    bundle = new TransientBundle_1.TransientBundle();\n                    bundle.expires = 0;\n                    bundle.payload = undefined;\n                }\n                const { expires, timeoutID } = bundle;\n                const timespan = expires - Date.now();\n                if (expires <= 0) {\n                    yield this.expireBundle(cacheKey);\n                }\n                else if (!timeoutID) {\n                    bundle.timeoutID = setTimeout(() => __awaiter(this, void 0, void 0, function* () {\n                        const expiredBundle = yield this.expireBundle(cacheKey);\n                        this.emit(TransientStore.TOPIC.EXPIRED, expiredBundle);\n                    }), timespan);\n                }\n                return bundle;\n            });\n        }\n    }\n    TransientStore.TOPIC = TOPIC;\n    return TransientStore;\n})();\nexports.TransientStore = TransientStore;\n//# sourceMappingURL=TransientStore.js.map","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = $getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  var args = [];\n  for (var i = 0; i < arguments.length; i++) args.push(arguments[i]);\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    ReflectApply(this.listener, this.target, args);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n"],"sourceRoot":""}